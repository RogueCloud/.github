# Repo-specific approval configuration for issueops-approvals
# Multi-environment deployment approval flow: dev â†’ qa â†’ stage â†’ prod

version: 1

defaults:
  timeout: 72h
  allow_self_approval: true
  issue_labels:
    - approval-required

policies:
  # Anyone on the team can approve dev
  developers:
    approvers: [jamengual]
    min_approvals: 1

  # QA team for QA environment
  qa-team:
    approvers: [jamengual]
    min_approvals: 1

  # Tech leads for staging
  tech-leads:
    approvers: [jamengual]
    min_approvals: 1

  # Senior engineers + security for production
  production-approvers:
    approvers: [jamengual]
    require_all: true

workflows:
  # DEV - Quick approval, any developer
  deploy-dev:
    description: "Deploy to DEV environment"
    require:
      - policy: developers
    on_approved:
      close_issue: true
      comment: |
        âœ… **DEV deployment approved!**

        Version `{{version}}` is deploying to DEV.

        ðŸ‘‰ Next step: Request QA deployment with `/deploy-qa`

  # QA - QA team approval required
  deploy-qa:
    description: "Deploy to QA environment"
    require:
      - policy: qa-team
    on_approved:
      close_issue: true
      comment: |
        âœ… **QA deployment approved!**

        Version `{{version}}` is deploying to QA.

        ðŸ‘‰ Next step: After QA validation, request staging with `/deploy-stage`

  # STAGING - Tech lead approval
  deploy-stage:
    description: "Deploy to STAGING environment"
    require:
      - policy: tech-leads
    on_approved:
      close_issue: true
      comment: |
        âœ… **STAGING deployment approved!**

        Version `{{version}}` is deploying to STAGING.

        ðŸ‘‰ Next step: After staging validation, request production with `/deploy-prod`

  # PRODUCTION - Requires all production approvers
  deploy-prod:
    description: "Deploy to PRODUCTION environment (requires all approvers)"
    require:
      - policy: production-approvers
    on_approved:
      create_tag: true
      close_issue: true
      comment: |
        ðŸš€ **PRODUCTION deployment approved!**

        Version `{{version}}` is now live in production.
        Tag `{{tag}}` has been created.

  # Release workflow (original)
  release:
    description: "Release approval"
    require:
      - policy: developers
    on_approved:
      create_tag: true
      close_issue: true
      comment: "Release approved! Tag {{tag}} created."
